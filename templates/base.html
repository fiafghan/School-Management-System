<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}سیستم مدیریت فیس - لیسه عالی خصوصی الازهر{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Global Afghan month names for Jalali datepickers -->
    <script>
        // Strong, safe translator: walk text nodes only while the picker is open
        (function() {
          const MAP = new Map([
            ['فروردین','حمل'], ['اردیبهشت','ثور'], ['خرداد','جوزا'], ['تیر','سرطان'],
            ['مرداد','اسد'], ['شهریور','سنبله'], ['مهر','میزان'], ['آبان','عقرب'],
            ['آذر','قوس'], ['دی','جدی'], ['بهمن','دلو'], ['اسفند','حوت']
          ]);
        
          // Replace in text nodes only (no innerHTML edits)
          function replaceInTextNode(node) {
            if (!node || node.nodeType !== Node.TEXT_NODE) return;
            let text = node.nodeValue;
            if (!text) return;
            // Remove zero-width joiners just for matching (don’t keep them)
            const clean = text.replace(/\u200c/g, '');
            let out = clean;
            MAP.forEach((to, from) => { out = out.split(from).join(to); });
            if (out !== clean) node.nodeValue = out;
          }
        
          function walkAndTranslate(root) {
            if (!root) return;
            const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
            const txtNodes = [];
            let n;
            while ((n = walker.nextNode())) txtNodes.push(n);
            txtNodes.forEach(replaceInTextNode);
          }
        
          function getPickerRoot() {
            // include more variants here if needed
            return document.querySelector(
              '.pwt-datepicker, .datepicker-plot-area, .pc-container, .jcalendar, .pwt-date-selector, .popover-date'
            );
          }
        
          let timer = null, ticks = 0;
          function start() {
            stop();
            ticks = 0;
            timer = setInterval(() => {
              const root = getPickerRoot();
              if (root) walkAndTranslate(root);
              if (++ticks > 60) stop(); // ~6s is enough to cover navigation
            }, 100);
          }
          function stop() {
            if (timer) clearInterval(timer);
            timer = null;
          }
        
          window.addEventListener('load', () => setTimeout(start, 0));
          const input = document.querySelector('input[name="registration_date"]');
          if (input) {
            input.addEventListener('focus', () => setTimeout(start, 10));
            input.addEventListener('click', () => setTimeout(start, 10));
            input.addEventListener('change', () => setTimeout(stop, 500));
          }
        })();
        </script>
    <!-- Persian Font -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        .rtl {
            direction: rtl;
        }
        
        .sidebar-active {
            background-color: #3b82f6;
            color: white;
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .table-hover tbody tr:hover {
            background-color: #f9fafb;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .alert-warning {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .alert-info {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50 rtl">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-800">
                            سیستم مدیریت فیس - لیسه عالی خصوصی الازهر
                        </h1>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <a href="{% url 'dashboard' %}" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">
                        داشبورد
                    </a>
                    <a href="{% url 'student_list' %}" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">
                        شاگردان
                    </a>
                    <a href="{% url 'payment_list' %}" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">
                        پرداخت‌ها
                    </a>
                    <a href="{% url 'reports' %}" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">
                        گزارشات
                    </a>
                    <a href="/admin/" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">
                        مدیریت
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Messages -->
    {% if messages %}
        <div class="max-w-7xl mx-auto px-4 mt-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto py-4 px-4">
            <div class="text-center text-gray-600 text-sm">
                <p> 2024 لیسه عالی خصوصی الازهر - سیستم مدیریت فیس</p>
                <p class="mt-1">توسعه یافته توسط فردین ابراهیمی</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Auto-hide alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(function() {
                        alert.remove();
                    }, 500);
                }, 5000);
            });
        });
        
        // Confirm delete actions
        function confirmDelete(message) {
            return confirm(message || 'آیا مطمئن هستید که می‌خواهید این مورد را حذف کنید؟');
        }
        
        // Format numbers with Persian digits
        function toPersianDigits(num) {
            const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
            return num.toString().replace(/\d/g, (digit) => persianDigits[digit]);
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('fa-AF', {
                style: 'currency',
                currency: 'AFN',
                minimumFractionDigits: 0
            }).format(amount);
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
